<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 900">
  <defs>
    <!-- 定义样式 -->
    <style>
      .node-box { fill: #4A90E2; stroke: #2E5C8A; stroke-width: 2; }
      .node-dark { fill: #2E5C8A; }
      .node-light { fill: #6BA3E5; }
      .node-text { fill: white; font-family: 'Arial', sans-serif; font-size: 12px; text-anchor: middle; }
      .interface-box { fill: #F39C12; stroke: #D68910; stroke-width: 2; }
      .interface-text { fill: #2C3E50; font-family: 'Arial', sans-serif; font-size: 11px; text-anchor: middle; }
      .connection { stroke: #34495E; stroke-width: 2; fill: none; }
      .connection-arrow { fill: #34495E; }
      .buffer-box { fill: #27AE60; stroke: #1E8449; stroke-width: 2; }
      .arbiter-box { fill: #E74C3C; stroke: #C0392B; stroke-width: 2; }
      .topology-box { fill: #9B59B6; stroke: #7D3C98; stroke-width: 2; }
      .clock-gate { fill: #95A5A6; stroke: #7F8C8D; stroke-width: 2; }
      .fault-indicator { fill: #E74C3C; opacity: 0.7; }
      .grid-line { stroke: #BDC3C7; stroke-width: 1; stroke-dasharray: 5,5; }
      .stage-label { fill: #2C3E50; font-family: 'Arial', sans-serif; font-size: 14px; font-weight: bold; }
      .data-flow { stroke: #3498DB; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .control-flow { stroke: #E67E22; stroke-width: 2; fill: none; stroke-dasharray: 3,3; }
    </style>

    <!-- 定义箭头 -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" class="connection-arrow"/>
    </marker>

    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#E74C3C"/>
    </marker>
  </defs>

  <!-- 背景 -->
  <rect width="1400" height="900" fill="#ECF0F1"/>

  <!-- 标题 -->
  <text x="700" y="30" font-family="Arial, sans-serif" font-size="24px" font-weight="bold" text-anchor="middle" fill="#2C3E50">
    MAZE 64-Node Network-on-Chip Architecture
  </text>
  <text x="700" y="55" font-family="Arial, sans-serif" font-size="14px" text-anchor="middle" fill="#7F8C8D">
    8×8 Mesh Topology with 4-Stage Pipeline Processing
  </text>

  <!-- 系统边界框 -->
  <rect x="20" y="80" width="1360" height="800" fill="white" stroke="#34495E" stroke-width="3" rx="10" ry="10"/>
  <text x="50" y="110" font-family="Arial, sans-serif" font-size="16px" font-weight="bold" fill="#2C3E50">
    MAZE_TOP Module
  </text>

  <!-- 全局控制信号 -->
  <g id="global-signals">
    <rect x="50" y="130" width="200" height="120" class="clock-gate"/>
    <text x="150" y="155" class="interface-text" font-weight="bold">Global Control</text>
    <text x="150" y="175" class="interface-text">• clk (System Clock)</text>
    <text x="150" y="195" class="interface-text">• rst_n (Reset)</text>
    <text x="150" y="215" class="interface-text">• pg_en (Fault Enable)</text>
    <text x="150" y="235" class="interface-text">• pg_node [5:0]</text>
  </g>

  <!-- 8x8 网格节点 (简化显示) -->
  <g id="node-grid">
    <!-- 网格标签 -->
    <text x="700" y="120" class="stage-label" text-anchor="middle">64-Node Array (8×8 Grid)</text>

    <!-- 生成网格节点 -->
    <!-- 为了简化，只显示部分节点作为示例 -->

    <!-- Node (0,0) -->
    <g id="node-0-0" transform="translate(200, 300)">
      <rect width="80" height="80" class="node-box" rx="5" ry="5"/>
      <rect x="0" y="0" width="80" height="20" class="node-dark" rx="5" ry="5"/>
      <text x="40" y="15" class="node-text" font-size="10px">Node[0,0]</text>
      <text x="40" y="40" class="node-text" font-size="8px">4-Stage</text>
      <text x="40" y="55" class="node-text" font-size="8px">Pipeline</text>
      <text x="40" y="70" class="node-text" font-size="8px">HP=0, VP=0</text>

      <!-- A接口标记 -->
      <rect x="30" y="-15" width="20" height="15" class="interface-box"/>
      <text x="40" y="-5" class="interface-text" font-size="8px">A</text>

      <!-- B接口标记 -->
      <rect x="30" y="80" width="20" height="15" class="interface-box"/>
      <text x="40" y="90" class="interface-text" font-size="8px">B</text>
    </g>

    <!-- Node (1,0) -->
    <g id="node-1-0" transform="translate(320, 300)">
      <rect width="80" height="80" class="node-box" rx="5" ry="5"/>
      <rect x="0" y="0" width="80" height="20" class="node-dark" rx="5" ry="5"/>
      <text x="40" y="15" class="node-text" font-size="10px">Node[1,0]</text>
      <text x="40" y="40" class="node-text" font-size="8px">HP=1, VP=0</text>
    </g>

    <!-- Node (0,1) -->
    <g id="node-0-1" transform="translate(200, 420)">
      <rect width="80" height="80" class="node-box" rx="5" ry="5"/>
      <rect x="0" y="0" width="80" height="20" class="node-dark" rx="5" ry="5"/>
      <text x="40" y="15" class="node-text" font-size="10px">Node[0,1]</text>
      <text x="40" y="40" class="node-text" font-size="8px">HP=0, VP=1</text>
    </g>

    <!-- 故障节点示例 -->
    <g id="node-fault" transform="translate(440, 300)">
      <rect width="80" height="80" class="fault-indicator" rx="5" ry="5"/>
      <rect x="0" y="0" width="80" height="20" class="node-dark" rx="5" ry="5"/>
      <text x="40" y="15" class="node-text" font-size="10px">Node[F]</text>
      <text x="40" y="40" class="node-text" font-size="8px">FAULT</text>
      <text x="40" y="55" class="node-text" font-size="8px">Gated</text>
      <text x="40" y="70" class="node-text" font-size="8px">Clock</text>
    </g>

    <!-- 简化的网格连接指示 -->
    <line x1="280" y1="340" x2="320" y2="340" class="connection" marker-end="url(#arrowhead)"/>
    <line x1="240" y1="380" x2="240" y2="420" class="connection" marker-end="url(#arrowhead)"/>

    <!-- 网格省略标记 -->
    <text x="600" y="340" class="stage-label">...</text>
    <text x="400" y="550" class="stage-label">...</text>
    <text x="700" y="460" class="stage-label">56 More Nodes</text>
  </g>

  <!-- 节点内部架构详细图 -->
  <g id="node-detail" transform="translate(900, 200)">
    <text x="150" y="0" class="stage-label" text-anchor="middle">Node Internal Architecture</text>

    <!-- 节点边界 -->
    <rect x="0" y="20" width="400" height="400" fill="white" stroke="#2C3E50" stroke-width="2" rx="5" ry="5"/>

    <!-- Stage 0: Input Processing -->
    <g id="stage-0">
      <rect x="20" y="40" width="360" height="80" fill="#E8F6F3" stroke="#16A085" stroke-width="2" rx="3" ry="3"/>
      <text x="200" y="60" class="stage-label" text-anchor="middle">Stage 0: Input Preprocessing</text>

      <!-- A接口输入 -->
      <rect x="40" y="70" width="60" height="30" class="interface-box"/>
      <text x="70" y="90" class="interface-text" font-size="10px">A Iface</text>

      <!-- 故障检测 -->
      <rect x="120" y="70" width="80" height="30" class="buffer-box"/>
      <text x="160" y="90" class="interface-text" font-size="10px">Fault Detect</text>

      <!-- 路由计算 -->
      <rect x="220" y="70" width="100" height="30" class="buffer-box"/>
      <text x="270" y="90" class="interface-text" font-size="10px">Route Calc</text>

      <!-- IRS输入缓冲 -->
      <rect x="340" y="70" width="30" height="30" class="buffer-box"/>
      <text x="355" y="90" class="interface-text" font-size="8px">IRS</text>
    </g>

    <!-- Stage 1: QoS Arbitration -->
    <g id="stage-1">
      <rect x="20" y="130" width="360" height="80" fill="#FEF5E7" stroke="#F39C12" stroke-width="2" rx="3" ry="3"/>
      <text x="200" y="150" class="stage-label" text-anchor="middle">Stage 1: QoS Arbitration</text>

      <!-- X方向仲裁器 -->
      <rect x="40" y="160" width="100" height="30" class="arbiter-box"/>
      <text x="90" y="180" class="interface-text" font-size="10px">X-Arbiters</text>
      <text x="90" y="175" class="interface-text" font-size="8px">(7 arbiters)</text>

      <!-- Y方向仲裁器 -->
      <rect x="160" y="160" width="100" height="30" class="arbiter-box"/>
      <text x="210" y="180" class="interface-text" font-size="10px">Y-Arbiters</text>
      <text x="210" y="175" class="interface-text" font-size="8px">(7 arbiters)</text>

      <!-- B端口仲裁器 -->
      <rect x="280" y="160" width="80" height="30" class="arbiter-box"/>
      <text x="320" y="180" class="interface-text" font-size="10px">B-Arbiter</text>
    </g>

    <!-- Stage 2: Output Selection -->
    <g id="stage-2">
      <rect x="20" y="220" width="360" height="80" fill="#FADBD8" stroke="#E74C3C" stroke-width="2" rx="3" ry="3"/>
      <text x="200" y="240" class="stage-label" text-anchor="middle">Stage 2: Output Selection</text>

      <!-- 数据选择器 -->
      <rect x="40" y="250" width="150" height="30" fill="#AED6F1" stroke="#3498DB" stroke-width="1"/>
      <text x="115" y="270" class="interface-text" font-size="10px">X-Output MUX</text>

      <rect x="210" y="250" width="150" height="30" fill="#AED6F1" stroke="#3498DB" stroke-width="1"/>
      <text x="285" y="270" class="interface-text" font-size="10px">Y-Output MUX</text>
    </g>

    <!-- Stage 3: Output Buffering -->
    <g id="stage-3">
      <rect x="20" y="310" width="360" height="80" fill="#EDEDED" stroke="#95A5A6" stroke-width="2" rx="3" ry="3"/>
      <text x="200" y="330" class="stage-label" text-anchor="middle">Stage 3: Output Buffering</text>

      <!-- IRS输出缓冲 -->
      <rect x="40" y="340" width="60" height="30" class="buffer-box"/>
      <text x="70" y="360" class="interface-text" font-size="10px">IRS Out</text>

      <!-- B接口输出 -->
      <rect x="120" y="340" width="60" height="30" class="interface-box"/>
      <text x="150" y="360" class="interface-text" font-size="10px">B Iface</text>

      <!-- C接口输出 -->
      <rect x="200" y="340" width="140" height="30" class="topology-box"/>
      <text x="270" y="360" class="interface-text" font-size="10px">C Interface (Topology)</text>
    </g>

    <!-- 时钟门控 -->
    <rect x="320" y="40" width="60" height="40" class="clock-gate"/>
    <text x="350" y="65" class="interface-text" font-size="10px">Clock</text>
    <text x="350" y="75" class="interface-text" font-size="8px">Gate</text>
  </g>

  <!-- 拓扑连接模块 -->
  <g id="topology-module" transform="translate(100, 650)">
    <rect x="0" y="0" width="1200" height="120" fill="#F4ECF7" stroke="#8E44AD" stroke-width="2" rx="5" ry="5"/>
    <text x="600" y="25" class="stage-label" text-anchor="middle">Topo Module - Network Connectivity</text>

    <!-- X方向连接 -->
    <rect x="50" y="40" width="200" height="60" class="topology-box"/>
    <text x="150" y="65" class="interface-text" font-size="12px">X-Direction Connections</text>
    <text x="150" y="85" class="interface-text" font-size="10px">Same X, Different Y</text>
    <text x="150" y="100" class="interface-text" font-size="10px">7 connections per node</text>

    <!-- Y方向连接 -->
    <rect x="300" y="40" width="200" height="60" class="topology-box"/>
    <text x="400" y="65" class="interface-text" font-size="12px">Y-Direction Connections</text>
    <text x="400" y="85" class="interface-text" font-size="10px">Same Y, Different X</text>
    <text x="400" y="100" class="interface-text" font-size="10px">7 connections per node</text>

    <!-- IRS模块 -->
    <rect x="550" y="40" width="200" height="60" class="buffer-box"/>
    <text x="650" y="65" class="interface-text" font-size="12px">IRS Modules</text>
    <text x="650" y="85" class="interface-text" font-size="10px">Manhattan Distance</text>
    <text x="650" y="100" class="interface-text" font-size="10px">Dynamic Buffer Depth</text>

    <!-- 故障处理 -->
    <rect x="800" y="40" width="200" height="60" class="fault-indicator"/>
    <text x="900" y="65" class="interface-text" font-size="12px">Fault Tolerance</text>
    <text x="900" y="85" class="interface-text" font-size="10px">Route Avoidance</text>
    <text x="900" y="100" class="interface-text" font-size="10px">Clock Gating</text>
  </g>

  <!-- 数据流示例 -->
  <g id="data-flow-example">
    <path d="M 200 285 Q 240 260 240 285" class="data-flow" stroke-dasharray="0"/>
    <text x="180" y="260" class="interface-text" font-size="10px">External Input</text>

    <path d="M 520 340 Q 560 340 560 400 Q 560 460 600 460" class="data-flow"/>
    <text x="570" y="400" class="interface-text" font-size="10px">Network</text>

    <path d="M 240 460 Q 240 500 200 500" class="data-flow" stroke-dasharray="5,5"/>
    <text x="180" y="495" class="interface-text" font-size="10px">Output</text>
  </g>

  <!-- 性能指标 -->
  <g id="performance-metrics" transform="translate(50, 820)">
    <text x="0" y="0" class="stage-label">Performance Characteristics:</text>
    <text x="0" y="20" class="interface-text" font-size="12px">• Network Latency: 4 clock cycles (pipeline) + 2 hops (unicast)</text>
    <text x="0" y="40" class="interface-text" font-size="12px">• Packet Format: 23-bit (2 type + 1 QoS + 6 src + 6 tgt + 8 data)</text>
    <text x="0" y="60" class="interface-text" font-size="12px">• QoS Levels: 2 (High Priority Absolute Priority)</text>
    <text x="800" y="20" class="interface-text" font-size="12px">• Fault Tolerance: Single node failure with clock gating</text>
    <text x="800" y="40" class="interface-text" font-size="12px">• Routing: Two-hop unicast, Multicast, Broadcast</text>
    <text x="800" y="60" class="interface-text" font-size="12px">• Buffer Count: 31 buffers per node (16 in + 15 out)</text>
  </g>
</svg>