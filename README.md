# MAZE网络芯片项目

## 项目概述

MAZE是一个64节点的8×8网格网络芯片（Network-on-Chip）项目，支持非流水线的直接路由架构，具备QoS优先级调度和故障容错能力。

## 主要特性

- **网络拓扑**: 8×8网格，每节点连接NWSE四个方向邻居
- **路由架构**: 非流水线直接路由，5个并行输入输出端口
- **故障容错**: 支持单节点故障，智能路径重构
- **QoS支持**: 两级优先级，高QoS绝对优先权
- **多播/广播**: 支持相同坐标多播和全网广播
- **低延迟**: 2时钟周期总延迟

## 项目结构

```
maze_mesh/
├── 📄 README.md                      # 项目说明文档（本文件）
├── 📄 MAZE题目要求.md                 # 详细题目要求和新架构说明
├── 📄 路由策略.md                     # 故障感知XY路由算法
├── 📄 CLAUDE.md                      # 完整架构设计文档（Claude使用）
├── 📁 rtl/                           # RTL代码目录
│   ├── 📁 include/                    # 包含文件
│   │   ├── 📁 interfaces/            # 接口定义
│   │   │   ├── interface_a.sv        # A接口（数据包输入）
│   │   │   ├── interface_b.sv        # B接口（数据包输出）
│   │   │   └── interface_c.sv        # C接口（NWSE四方向连接）
│   │   └── 📁 global_defines/        # 全局参数定义
│   │       └── top_define.v          # 网络参数（支持64节点）
│   ├── 📁 src/                        # 源代码
│   │   ├── 📁 node/                   # 节点模块
│   │   │   └── node.v                # 网络节点（待实现）
│   │   ├── 📁 topo/                   # 拓扑模块
│   │   │   └── topo.v                # 拓扑连接（待实现）
│   │   └── 📁 system/                 # 系统模块
│   │       └── MAZE_TOP.v            # 顶层模块（待实现）
│   └── 📁 lib/                        # 库文件
│       └── 📁 irs/                    # IRS缓冲器
│           └── irs.v                 # 插入式环形缓冲器
├── 📁 docs/                          # 文档目录
│   └── 📁 design/                     # 设计文档
│       └── node_architecture.md      # 节点架构详细设计
├── 📁 Provided_Code/                 # 参考代码（不可修改）
│   ├── MAZE_TOP.v                    # 参考顶层模块
│   ├── node.v                        # 参考节点模块（流水线架构）
│   ├── topo.v                        # 参考拓扑模块
│   ├── irs.v                         # 参考IRS模块
│   ├── interface_a.sv                 # 参考A接口
│   ├── interface_b.sv                 # 参考B接口
│   ├── interface_c.sv                 # 参考C接口
│   └── top_define.v                  # 参考参数定义
└── 📁 maze_impl/                     # 旧实现（已废弃）
```

## 接口定义

### A接口 (pkt_in) - 数据包输入
- **pkt_in_vld**: 数据包有效信号
- **pkt_in_qos**: QoS优先级 (0=低, 1=高)
- **pkt_in_type**: 数据包类型 (00=单播, 01=X多播, 10=Y多播, 11=广播)
- **pkt_in_src**: 源节点ID (6位，支持64节点)
- **pkt_in_tgt**: 目标节点ID (6位，支持64节点)
- **pkt_in_data**: 数据负载 (8位)
- **pkt_in_rdy**: 接收就绪信号（反压控制）

### B接口 (pkt_out) - 数据包输出
- 信号定义与A接口相同，但方向相反
- 用于节点输出数据包到外部

### C接口 (pkt_con_if) - 节点间连接
- **ni_*/wi_*/si_*/ei_***: 北/西/南/东输入信号
- **no_*/wo_*/so_*/eo_***: 北/西/南/东输出信号
- 支持完整的握手机制和流量控制

## 数据包格式

```
[1:0]   pkt_type    // 00=单播, 01=X多播, 10=Y多播, 11=广播
[0]     pkt_qos     // 0=低优先级, 1=高优先级
[5:3]   src_y       // 源节点Y坐标
[2:0]   src_x       // 源节点X坐标
[5:3]   tgt_y       // 目标节点Y坐标
[2:0]   tgt_x       // 目标节点X坐标
[7:0]   pkt_data    // 数据负载
```

## 节点架构

每个MAZE节点采用非流水线直接路由架构：

```
输入端口 (5个)     路由处理 (5个单元)     输出仲裁 (5个仲裁器)     输出端口 (5个)
├─ A口 (外部)      ├─ 路由单元_A         ├─ 仲裁器_N (北)          ├─ B口 (外部)
├─ C口_N (北)      ├─ 路由单元_N         ├─ 仲裁器_W (西)          ├─ C口_N (北)
├─ C口_W (西)      ├─ 路由单元_W         ├─ 仲裁器_S (南)          ├─ C口_W (西)
├─ C口_S (南)      ├─ 路由单元_S         ├─ 仲裁器_E (东)          ├─ C口_S (南)
└─ C口_E (东)      └─ 路由单元_E         └─ 仲裁器_B (本地)        └─ C口_E (东)
   ↓ IRS_N           ↓ 故障感知路由        ↓ QoS仲裁               ↓ IRS_N (RO_EN=1)
```

## 路由算法

### 故障感知XY路由
- **基本策略**: 优先X方向，次选Y方向
- **故障处理**: 根据故障节点相对位置选择绕行路径
- **位置类型**: NORMAL, N_OF_x, NE_OF_x, E_OF_x, SE_OF_x, S_OF_x, SW_OF_x, W_OF_x, NW_OF_x
- **静态配置**: 故障信息预先配置到所有节点

详细算法实现见：`路由策略.md`

## 性能特性

- **网络延迟**: 2时钟周期 (1周期路由 + 1周期仲裁) + 路径跳数
- **吞吐量**: 每周期最多处理5个输入数据包
- **仲裁延迟**: 1个时钟周期的QoS仲裁延迟
- **容错性能**: 单节点故障容错，自动路径重构
- **缓冲能力**: IRS_N提供输入输出缓冲，支持流量控制

## 开发状态

### ✅ 已完成
- [x] 项目架构设计更新（非流水线 + NWSE四方向）
- [x] 接口定义更新（A/B/C接口中文化）
- [x] 路由算法文档完善
- [x] IRS缓冲器集成
- [x] 全局参数定义
- [x] 项目文档中文化

### ⚠️ 待实现
- [ ] 节点模块内部逻辑（5个路由单元 + 5个仲裁器）
- [ ] 拓扑模块连接逻辑
- [ ] 顶层模块实例化
- [ ] 故障感知路由算法实现
- [ ] QoS仲裁逻辑实现

## 构建和仿真

### 编译命令
```bash
# 编译MAZE_TOP模块
verilator --top-module MAZE_TOP --cc -f rtl.filelist -Wno-fatal --CFLAGS "-std=c++11" --Mdir obj_dir

# 编译可执行文件
cd obj_dir && make -f VMAZE_TOP.mk
```

### 运行仿真
```bash
# 基本仿真
./VMAZE_TOP

# 特定测试用例
./VMAZE_TOP +TEST_CASE=unicast_test
./VMAZE_TOP +TEST_CASE=qos_test
./VMAZE_TOP +TEST_CASE=fault_test
```

## 文档参考

- [`CLAUDE.md`](CLAUDE.md) - 完整架构设计和技术文档
- [`MAZE题目要求.md`](MAZE题目要求.md) - 详细题目要求和架构说明
- [`路由策略.md`](路由策略.md) - 故障感知XY路由算法
- [`docs/design/node_architecture.md`](docs/design/node_architecture.md) - 节点架构详细设计

## 贡献指南

1. 所有新代码和注释必须使用中文
2. 遵循现有的文件结构和命名规范
3. 确保代码风格一致性
4. 更新相关文档说明

## 许可证

本项目仅用于学术研究和教学目的。

---

**项目维护**: Claude Code Assistant
**最后更新**: 2025年11月15日